<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco-Gesto - Debug Mode</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a2e;
            color: #4ecca3;
            padding: 20px;
        }
        .debug-section {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            margin: 10px 0;
            border: 1px solid #4ecca3;
            border-radius: 5px;
        }
        #videoInput {
            width: 640px;
            height: 480px;
            border: 2px solid #4ecca3;
            transform: scaleX(-1);
        }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            background: rgba(78, 204, 163, 0.1);
        }
        .error { color: #ff6b6b; }
        .success { color: #4ecca3; }
        .warning { color: #ffe66d; }
    </style>
</head>
<body>
    <h1>üêõ Eco-Gesto Debug Mode</h1>
    
    <div class="debug-section">
        <h3>Status do Sistema</h3>
        <div id="systemStatus">Aguardando inicializa√ß√£o...</div>
    </div>

    <div class="debug-section">
        <h3>V√≠deo e Detec√ß√£o</h3>
        <video id="videoInput" autoplay playsinline></video>
        <canvas id="poseCanvas" style="position:absolute; left:20px; pointer-events:none;"></canvas>
    </div>

    <div class="debug-section">
        <h3>Logs em Tempo Real</h3>
        <button onclick="clearLogs()">Limpar Logs</button>
        <button onclick="testGesture()">Testar Gesto Manual</button>
        <div id="logContainer" style="max-height: 300px; overflow-y: auto;"></div>
    </div>

    <div class="debug-section">
        <h3>Features Detectadas</h3>
        <pre id="featuresDisplay">Nenhuma feature detectada ainda...</pre>
    </div>

    <div class="debug-section">
        <h3>Criaturas Ativas</h3>
        <pre id="creaturesDisplay">Nenhuma criatura criada ainda...</pre>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <script type="module">
        import BodyTracker from './js/modules/BodyTracker.js';
        import SoundEngine from './js/modules/SoundEngine.js';

        const logContainer = document.getElementById('logContainer');
        const featuresDisplay = document.getElementById('featuresDisplay');
        const creaturesDisplay = document.getElementById('creaturesDisplay');
        const systemStatus = document.getElementById('systemStatus');

        function log(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContainer.insertBefore(entry, logContainer.firstChild);
            console.log(message);
        }

        window.clearLogs = () => {
            logContainer.innerHTML = '';
        };

        // Capturar logs do console
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            log(args.join(' '), 'info');
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            log(args.join(' '), 'error');
        };

        let bodyTracker, soundEngine;
        let creatures = [];

        window.testGesture = () => {
            log('üß™ Testando cria√ß√£o manual de criatura...', 'warning');
            const testGesture = {
                type: 'explosive',
                features: {
                    position: { x: 0.5, y: 0.5 },
                    velocity: 0.05,
                    amplitude: 0.3,
                    direction: { x: 0.1, y: -0.1 },
                    openness: 0.4,
                    energy: 0.8
                },
                timestamp: Date.now()
            };
            
            const creature = soundEngine.createCreatureFromGesture(testGesture);
            creatures.push(creature);
            soundEngine.playCreature(creature);
            log(`‚úÖ Criatura teste criada: ${creature.name}`, 'success');
            updateCreaturesDisplay();
        };

        function updateCreaturesDisplay() {
            creaturesDisplay.textContent = JSON.stringify(creatures, null, 2);
        }

        async function init() {
            try {
                log('üöÄ Iniciando sistema debug...', 'info');
                systemStatus.innerHTML = '<span class="warning">Iniciando...</span>';

                // Verificar MediaPipe
                if (typeof window.Hands === 'undefined') {
                    log('‚ùå MediaPipe Hands n√£o carregado!', 'error');
                    systemStatus.innerHTML = '<span class="error">ERRO: MediaPipe n√£o carregado</span>';
                    return;
                }
                log('‚úÖ MediaPipe Hands dispon√≠vel', 'success');

                // Inicializar BodyTracker
                bodyTracker = new BodyTracker();
                
                bodyTracker.onGestureDetected = (gesture) => {
                    log(`üñêÔ∏è GESTO DETECTADO: ${gesture.type}`, 'success');
                    featuresDisplay.textContent = JSON.stringify(gesture.features, null, 2);
                    
                    // Criar criatura
                    const creature = soundEngine.createCreatureFromGesture(gesture);
                    creatures.push(creature);
                    soundEngine.playCreature(creature);
                    log(`üéµ Criatura criada: ${creature.name}`, 'success');
                    updateCreaturesDisplay();
                };

                await bodyTracker.init();
                log('‚úÖ BodyTracker inicializado', 'success');

                // Inicializar SoundEngine
                soundEngine = new SoundEngine();
                await soundEngine.init();
                log('‚úÖ SoundEngine inicializado', 'success');

                systemStatus.innerHTML = '<span class="success">‚úÖ SISTEMA ATIVO - Mova sua m√£o!</span>';
                log('üéâ Sistema pronto! Fa√ßa gestos com a m√£o na c√¢mera.', 'success');
                
            } catch (error) {
                log(`‚ùå ERRO: ${error.message}`, 'error');
                systemStatus.innerHTML = `<span class="error">ERRO: ${error.message}</span>`;
                console.error(error);
            }
        }

        // Iniciar quando p√°gina carregar
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
